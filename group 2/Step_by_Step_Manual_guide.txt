## ğŸ¯ Pipeline Overview

This automated pipeline processes raw genomic sequencing data through quality control, assembly, annotation, and metabolic pathway mapping using industry-standard bioinformatics tools.

***

## ğŸ› ï¸ Setting Environment

### ğŸ Create Conda Environment

```bash
~/.bashrc
conda create -n odog_env python=3.9 -y
conda activate odog_env
```

***

## ğŸ“Š Step 1: Quality Control â€” FastQC (Raw Reads)

### ğŸ”§ Installation

```bash
conda install -y -c bioconda fastqc
fastqc --version
```

### â–¶ï¸ Run FastQC

```bash
mkdir -p out/Aeromonas_simiae/Aeromonas_simiae_fastqc_raw

fastqc raw/Aeromonas_simiae/Aeromonas_simiae_R1_001.fastq.gz \
       raw/Aeromonas_simiae/Aeromonas_simiae_R1_002.fastq.gz \
       -o out/SAMPLE_fastqc_raw
```

***

## âœ‚ï¸ Step 2: Read Trimming â€” fastp

### ğŸ”§ Installation

```bash
conda install -y -c bioconda fastp
fastp -v
```

### â–¶ï¸ Run fastp

```bash
mkdir -p out/Aeromonas_simiae/Aeromonas_simiae_clean_fastp

fastp \
  -i raw/Aeromonas_simiae/Aeromonas_simiae_R1_001.fastq.gz \
  -I raw/Aeromonas_simiae/Aeromonas_simiae_R2_001.fastq.gz \
  -o out/Aeromonas_simiae/Aeromonas_simiae_clean_fastp/Aeromonas_simiae_clean_R1.fastq.gz \
  -O out/Aeromonas_simiae/Aeromonas_simiae_clean_fastp/Aeromonas_simiae_clean_R2.fastq.gz \
  -h out/Aeromonas_simiae/Aeromonas_simiae_clean_fastp/report.html \
  -j out/Aeromonas_simiae/Aeromonas_simiae_clean_fastp/report.json
```

***

## ğŸ“ˆ Step 3: Quality Control â€” FastQC (Clean Reads)

### â–¶ï¸ Run FastQC on Cleaned Data

```bash
mkdir -p out/Aeromonas_simiae/Aeromonas_simiae_fastqc_clean

fastqc \
  out/Aeromonas_simiae/Aeromonas_simiae_clean_fastp/Aeromonas_simiae_clean_R1.fastq.gz \
  out/Aeromonas_simiae/Aeromonas_simiae_clean_fastp/Aeromonas_simiae_clean_R2.fastq.gz \
  -o out/Aeromonas_simiae/Aeromonas_simiae_fastqc_clean
```

***

## ğŸ§© Step 4: Genome Assembly â€” SPAdes

### ğŸ”§ Installation

```bash
conda install -y -c bioconda spades
spades.py --version
```

### â–¶ï¸ Run SPAdes Assembly

```bash
mkdir -p out/Aeromonas_simiae/Aeromonas_simiae_spades

spades.py \
  -1 out/Aeromonas_simiae/Aeromonas_simiae_clean_fastp/Aeromonas_simiae_clean_R1.fastq.gz \
  -2 out/Aeromonas_simiae/Aeromonas_simiae_clean_fastp/Aeromonas_simiae_clean_R2.fastq.gz \
  -o out/Aeromonas_simiae/Aeromonas_simiae_spades \
  --threads 4 \
  --memory 4
```

> **ğŸ“ Note:** SPAdes uses de Bruijn graph algorithms optimized for bacterial genome assembly[2][4][1]

***

## ğŸ¯ Step 5: Assembly Quality Assessment â€” QUAST

### ğŸ”§ Installation

```bash
conda create -n quast_env python=3.9 -y
conda activate quast_env
conda install -y -c bioconda quast
quast --version
```

### â–¶ï¸ Run QUAST

```bash
mkdir -p out/Aeromonas_simiae/Aeromonas_simiae_quast

quast \
  out/Aeromonas_simiae/Aeromonas_simiae_spades/contigs.fasta \
  -o out/Aeromonas_simiae/Aeromonas_simiae_quast
```

***

## ğŸ”¬ Step 6: Gene Prediction & Annotation â€” Prokka

### ğŸ”§ Installation

```bash
conda create -n odog_env -c conda-forge -c bioconda -y prokka hmmer diamond blast prodigal perl-xml-simple
```

### â–¶ï¸ Run Prokka

```bash
mkdir -p out/Aeromonas_simiae/Aeromonas_simiae_prokka

prokka /home/rajgondane/Aeromonas_simiae/Aeromonas_simiae_spades/contigs.fasta \
  --prefix contigs \
  --cpus 4 \
  --outdir /home/rajgondane/Automated_Test/prokka_out/contigs_prokka \
  --force
```

***

## ğŸ§¬ Step 7: Enzyme Annotation â€” KOfamScan

### ğŸ“¥ Database Setup

```bash
# Download KOfam HMM profiles
wget ftp://ftp.genome.jp/pub/db/kofam/profiles.tar.gz
tar -xvzf profiles.tar.gz

# Download KO list
wget ftp://ftp.genome.jp/pub/db/kofam/ko_list.gz
gunzip ko_list.gz

# Clone KOfamScan tool
git clone https://github.com/takaram/kofam_scan.git
chmod +x ~/kofam_scan/exec_annotation

# Install Ruby
conda install -y -c conda-forge ruby
```

### â–¶ï¸ Run KOfamScan

```bash
mkdir -p out/Aeromonas_simiae/KofamScan

/home/rajgondane/CoG_Automated/databases/kofam/kofam_scan/exec_annotation \
  -f detail-tsv \
  -o out/Aeromonas_simiae/KofamScan/Aeromonas_simiae_kegg.tsv \
  -p /home/rajgondane/CoG_Automated/databases/kofam/profiles/ \
  -k /home/rajgondane/CoG_Automated/databases/kofam/ko_list \
  --cpu 4 \
  out/Aeromonas_simiae/Aeromonas_simiae_prokka/Aeromonas_simiae.faa
```

**ğŸ“„ Output file:** `Aeromonas_simiae_kegg.tsv`

***

## ğŸ” Step 8: Filter Assigned KO Annotations

### â–¶ï¸ Extract High-Confidence KO Hits

```bash
grep '^\*' /home/rajgondane/CoG_Automated/out/Aeromonas_simiae/KofamScan/Aeromonas_simiae_kegg.tsv \
  > /home/rajgondane/CoG_Automated/out/Aeromonas_simiae/KofamScan/Aeromonas_simiae_kegg_filtered.tsv
```

**ğŸ“„ Output file:** `Aeromonas_simiae_kegg_filtered.tsv`

***

## ğŸ“‹ Step 9: Extract Unique KO IDs

### â–¶ï¸ Generate KO ID List

```bash
cut -f3 Aeromonas_simiae_kegg_filtered.tsv | sort -u > Aeromonas_simiae_KO_list.txt
```

**ğŸ“„ Output file:** `Aeromonas_simiae_KO_list.txt`

***

## ğŸ—ºï¸ Step 10: KEGG Pathway Mapping

### ğŸ“¥ Download KEGG Mapping Tables

```bash
mkdir -p out/Aeromonas_simiae/pathways_mapping
cd pathway_mappings/

# Download KOâ€“pathway links
wget https://rest.kegg.jp/link/pathway/ko -O ko_to_pathway.tab

# Download pathway titles
wget https://rest.kegg.jp/list/pathway -O pathway_titles.tab
```

### â–¶ï¸ Map KO IDs to Pathways

```bash
cd /home/rajgondane/CoG_Automated/out/Aeromonas_simiae/KofamScan

# Filter pathways for annotated KOs
grep -Ff Aeromonas_simiae_KO_list.txt \
  /home/rajgondane/pathways_mapping/ko_to_pathway.tab \
  > Aeromonas_simiae_ko_pathway_filtered.tab

# Keep only map pathways
grep 'map' Aeromonas_simiae_ko_pathway_filtered.tab \
  > Aeromonas_simiae_ko_pathway_filtered_clean.tab

# Clean formatting
sed 's/ko://; s/path://;' Aeromonas_simiae_ko_pathway_filtered_clean.tab \
  > Aeromonas_simiae_ko_pathway_clean.tsv
```

**ğŸ“„ Output files:**
- `Aeromonas_simiae_ko_pathway_filtered.tab`
- `Aeromonas_simiae_ko_pathway_filtered_clean.tab`
- `Aeromonas_simiae_ko_pathway_clean.tsv`

***

## ğŸ“š Step 11: Add Pathway Titles

### â–¶ï¸ Annotate Pathways with Descriptions

```bash
cd /home/rajgondane/CoG_Automated/out/Aeromonas_simiae/KofamScan

awk -F'\t' '
NR==FNR { title[$1]=$2; next }
{ print $1"\t"$2"\t"title[$2] }
' /home/rajgondane/pathways_mapping/pathway_titles.tab \
  Aeromonas_simiae_ko_pathway_clean.tsv \
  > Aeromonas_simiae_ko_pathway_final.tsv
```

**ğŸ“„ Output file:** `Aeromonas_simiae_ko_pathway_final.tsv`

***

## ğŸ§¹ Step 12: Clean KO Table for Merging

### â–¶ï¸ Prepare KO Annotation Table

```bash
cd /home/rajgondane/CoG_Automated/out/Aeromonas_simiae/KofamScan

awk -F'\t' '{
    gsub(/"/, "", $7)
    print $2"\t"$3"\t"$7
}' Aeromonas_simiae_kegg_filtered.tsv \
> Aeromonas_simiae_kegg_clean_final.tsv
```

**ğŸ“„ Output file:** `Aeromonas_simiae_kegg_clean_final.tsv`

***

## ğŸ”— Step 13: Join KO Annotations with Pathways

### â–¶ï¸ Create Master Table

```bash
cd /home/rajgondane/CoG_Automated/out/Aeromonas_simiae/KofamScan

awk -F'\t' '
BEGIN{OFS="\t"}
NR==FNR {map[$1]=$2"\t"$3; next}
{print $0, (map[$2] ? map[$2] : "NA\tNA")}
' Aeromonas_simiae_ko_pathway_final.tsv \
  Aeromonas_simiae_kegg_clean_final.tsv \
> Aeromonas_simiae_kegg_pathways.tsv
```

**ğŸ“„ Output file:** `Aeromonas_simiae_kegg_pathways.tsv`

***

## ğŸ“Š Step 14: Generate Pathway Gene Counts

### â–¶ï¸ Count Genes per Pathway

```bash
cd /home/rajgondane/CoG_Automated/out/Aeromonas_simiae/KofamScan

awk -F'\t' '
{
    count[$2]++;   # count pathway ID
    name[$2]=$3;   # store pathway name
}
END {
    for (p in count)
        print p "\t" name[p] "\t" count[p]
}' Aeromonas_simiae_ko_pathway_final.tsv \
| sort > Aeromonas_simiae_pathway_counts.tsv
```

**ğŸ“„ Output file:** `Aeromonas_simiae_pathway_counts.tsv`

***

## ğŸ‰ Final Output Summary

### ğŸ“ Key Output Files

| File | Description | ğŸ“Š Use |
|------|-------------|--------|
| `Aeromonas_simiae_kegg.tsv` | All KO annotations | Complete annotation data |
| `Aeromonas_simiae_kegg_filtered.tsv` | High-confidence KO hits | Quality-filtered annotations |
| `Aeromonas_simiae_KO_list.txt` | Unique KO identifiers | Enzyme inventory |
| `Aeromonas_simiae_ko_pathway_final.tsv` | KO-pathway mappings | Pathway connections |
| `Aeromonas_simiae_kegg_pathways.tsv` | Master annotation table | Complete functional profile |
| `Aeromonas_simiae_pathway_counts.tsv` | â­ **Pathway gene counts** | **Metabolic capabilities summary** |

---

## ğŸ§ª Biological Insights

The final `pathway_counts.tsv` reveals:

âœ… **Complete metabolic pathways** (high gene counts)  
âœ… **Partial pathways** (low gene counts)  
âœ… **Energy metabolism** capabilities  
âœ… **Biosynthetic pathways** presence  
âœ… **Environmental adaptation** potential  
âœ… **Functional comparison** with other organisms  

***

## ğŸ‘¥ Contributors

**Group 2 â€” MSc Bioinformatics**  
*Metabolic Pathway & Enzyme Annotation Pipeline Project*

***

## ğŸ“Œ References

Pipeline utilizes industry-standard tools:
- **FastQC** â€” Read quality assessment
- **fastp** â€” Read preprocessing
- **SPAdes** â€” Genome assembly[4][1]
- **QUAST** â€” Assembly quality control
- **Prokka** â€” Gene prediction
- **KOfamScan** â€” KEGG enzyme annotation
- **KEGG** â€” Pathway mapping database
